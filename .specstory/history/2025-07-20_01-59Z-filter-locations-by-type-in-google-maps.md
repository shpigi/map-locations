<!-- Generated by SpecStory -->

# Filter locations by type in Google Maps (2025-07-20 01:59Z)

_**User**_

the different type locations are shown in one group in google maps. Is it possible to add the ability to filter what is shown by type in google maps??

---

_**Assistant**_

I'll help you add filtering capabilities to the Google Maps integration. Let me first examine the current code structure to understand how the map is generated and then implement filtering functionality.


---

Read file: map_locations/core.py

---

Now let me read the rest of the file to see the current map generation functions:


---

Read file: map_locations/core.py

---

Now I understand the current implementation. The issue is that when using Google Maps tiles, all location types are shown in one group because the current implementation groups by the `group_by` parameter (which defaults to "type"), but there's no filtering mechanism to show/hide specific types.

Let me implement a filtering system that allows users to filter by location type. I'll add this functionality to both the CLI and the core functions.


---

```diff
  from collections import defaultdict
  from pathlib import Path
- from typing import Any, Dict, List, Set, cast
+ from typing import Any, Dict, List, Set, cast, Optional

  import folium
```

```diff
      map_filename: str = "map.html",
      tile_provider: str = "openstreetmap",
+     filter_types: Optional[List[str]] = None,
  ) -> None:
      """
```

```diff
          map_filename (str): Path to save the HTML map.
          tile_provider (str): Map tile provider ('openstreetmap', 'google_maps', 'google_satellite')
+         filter_types (list, optional): List of location types to include. If None, all types are shown.
      """
      if not locations:
          raise ValueError("No locations provided.")

+     # Filter locations by type if filter_types is provided
+     if filter_types:
+         locations = [loc for loc in locations if loc.get("type", "").lower() in [t.lower() for t in filter_types]]
+         if not locations:
+             raise ValueError(f"No locations found matching the specified types: {filter_types}")
+
      # Center the map
      first = locations[0]
```

```diff
      print(f"üó∫Ô∏è Map saved to: {Path(map_filename).resolve()}")

+
+ def show_locations_with_filtering(
+     locations: List[Dict[str, Any]],
+     map_filename: str = "map.html",
+     tile_provider: str = "openstreetmap",
+     filter_types: Optional[List[str]] = None,
+     group_by: str = "type",
+ ) -> None:
+     """
+     Create a folium map with filtering capabilities for location types.
+
+     Args:
+         locations (list): List of dicts loaded from YAML.
+         map_filename (str): Path to save the HTML map.
+         tile_provider (str): Map tile provider ('openstreetmap', 'google_maps', 'google_satellite')
+         filter_types (list, optional): List of location types to include. If None, all types are shown.
+         group_by (str): Field to group markers by (e.g., type, neighborhood, date_added).
+     """
+     show_locations_grouped(
+         locations=locations,
+         group_by=group_by,
+         map_filename=map_filename,
+         tile_provider=tile_provider,
+         filter_types=filter_types,
+     )
+
+
+ def get_available_types(locations: List[Dict[str, Any]]) -> List[str]:
+     """
+     Get a list of all available location types from the locations data.
+
+     Args:
+         locations (list): List of location dictionaries
+
+     Returns:
+         list: List of unique location types
+     """
+     types = set()
+     for loc in locations:
+         loc_type = loc.get("type", "")
+         if loc_type:
+             types.add(loc_type.lower())
+     return sorted(list(types))
+

  def show_locations_with_google_maps(
```

---

Now I need to update the CLI to support filtering. Let me modify the CLI to add filtering options:


---

```diff
      export_to_json,
      export_to_kml,
+     get_available_types,
      load_locations_from_yaml,
      show_locations_grouped,
+     show_locations_with_filtering,
  )

```

---

```diff
          help="Map tile provider (default: openstreetmap)",
      )
+     map_parser.add_argument(
+         "--filter-types",
+         "-f",
+         type=str,
+         nargs="+",
+         help="Filter locations by type(s). Can specify multiple types separated by spaces.",
+     )

      # Export command
```

---

```diff
    # Create map with Google Satellite view
    map-locations map passages.yaml --tile-provider google_satellite --output maps/passages/map.html
+
+   # Filter to show only restaurants and cafes
+   map-locations map passages.yaml --filter-types restaurant cafe --output maps/passages/food_map.html
+
+   # Filter to show only museums and galleries with Google Maps
+   map-locations map passages.yaml --filter-types museum gallery --tile-provider google_maps --output maps/passages/culture_map.html

    # Export to all formats
```

---

```diff
          print(f"üìç Loaded {len(locations)} locations")

+         # Show available types if filtering is requested
+         if args.filter_types:
+             available_types = get_available_types(locations)
+             print(f"üîç Available location types: {', '.join(available_types)}")
+             print(f"üéØ Filtering to show only: {', '.join(args.filter_types)}")
+
          # Create map
          print("üó∫Ô∏è Creating interactive map...")
```

```diff
              map_filename=args.output,
              tile_provider=args.tile_provider,
+             filter_types=args.filter_types,
          )

```

---

Now let me also add a new command to list available types, which will be helpful for users to know what types they can filter by:


---

```diff
          help="Export format (default: all)",
      )
+
+     # List types command
+     list_types_parser = subparsers.add_parser("list-types", help="List all available location types")
+     list_types_parser.add_argument(
+         "yaml_file",
+         type=str,
+         help="Path to YAML file containing location data",
+     )

      return parser
```

---

```diff
          sys.exit(1)

+
+ def handle_list_types_command(args: argparse.Namespace) -> None:
+     """Handle the list-types command."""
+     try:
+         # Load locations
+         print(f"üìÇ Loading locations from: {args.yaml_file}")
+         locations = load_locations_from_yaml(args.yaml_file)
+
+         if not locations:
+             print("‚ùå No locations found in the YAML file.")
+             sys.exit(1)
+
+         # Get and display available types
+         available_types = get_available_types(locations)
+
+         if not available_types:
+             print("‚ùå No location types found in the YAML file.")
+             sys.exit(1)
+
+         print(f"üìç Found {len(locations)} locations")
+         print(f"üîç Available location types ({len(available_types)}):")
+
+         for i, loc_type in enumerate(available_types, 1):
+             # Count locations of this type
+             count = sum(1 for loc in locations if loc.get("type", "").lower() == loc_type)
+             print(f"  {i:2d}. {loc_type} ({count} locations)")
+
+         print(f"\nüí° Use these types with --filter-types to create filtered maps:")
+         print(f"   Example: map-locations map {args.yaml_file} --filter-types {' '.join(available_types[:3])}")
+
+     except Exception as e:
+         print(f"‚ùå Error listing types: {e}")
+         sys.exit(1)
+

  def main(args: Optional[List[str]] = None) -> None:
```

```diff
      elif parsed_args.command == "export":
          handle_export_command(parsed_args)
+     elif parsed_args.command == "list-types":
+         handle_list_types_command(parsed_args)
      else:
          print(f"‚ùå Unknown command: {parsed_args.command}")
```

---

Now let me update the epilog to include the new list-types command:


---

```diff
    # Filter to show only museums and galleries with Google Maps
    map-locations map passages.yaml --filter-types museum gallery --tile-provider google_maps --output maps/passages/culture_map.html
+
+   # List all available location types
+   map-locations list-types passages.yaml

    # Export to all formats
```

---

Now let me test the implementation by running a quick test to make sure everything works correctly:


---

```bash
cd /home/lavi/lavi_src/map_locations && python -m map_locations.cli list-types passages.yaml
```

---
