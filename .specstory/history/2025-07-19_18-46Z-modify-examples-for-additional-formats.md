<!-- Generated by SpecStory -->

# Modify examples for additional formats (2025-07-19 18:46Z)

_**User**_

modify the examples to also export to additional formats

---

_**Assistant**_

I'll help you modify the code to export to additional formats. Let me first examine the current code and then add support for multiple export formats.


---

Read file: passages.yaml

---

Now I'll modify the code to support multiple export formats including JSON, CSV, GeoJSON, and KML. I'll add new functions for each format and update the main function to support multiple exports.


---

```diff
  import folium
  import yaml
+ import json
+ import csv
  from collections import defaultdict
  from pathlib import Path
```

```diff
      return data.get("locations", [])

+
+ def export_to_json(locations, output_path):
+     """
+     Export locations to JSON format.
+
+     Args:
+         locations (list): List of location dictionaries
+         output_path (str): Path to save the JSON file
+     """
+     os.makedirs(os.path.dirname(output_path), exist_ok=True)
+
+     with open(output_path, 'w', encoding='utf-8') as f:
+         json.dump({"locations": locations}, f, indent=2, ensure_ascii=False)
+
+     print(f"üìÑ JSON exported to: {Path(output_path).resolve()}")
+
+
+ def export_to_csv(locations, output_path):
+     """
+     Export locations to CSV format.
+
+     Args:
+         locations (list): List of location dictionaries
+         output_path (str): Path to save the CSV file
+     """
+     os.makedirs(os.path.dirname(output_path), exist_ok=True)
+
+     if not locations:
+         return
+
+     # Get all possible fields from all locations
+     all_fields = set()
+     for loc in locations:
+         all_fields.update(loc.keys())
+
+     fieldnames = sorted(list(all_fields))
+
+     with open(output_path, 'w', newline='', encoding='utf-8') as f:
+         writer = csv.DictWriter(f, fieldnames=fieldnames)
+         writer.writeheader()
+
+         for loc in locations:
+             # Ensure all fields are present (fill missing with empty string)
+             row = {field: loc.get(field, '') for field in fieldnames}
+             # Handle tags as comma-separated string
+             if 'tags' in row and isinstance(row['tags'], list):
+                 row['tags'] = ', '.join(row['tags'])
+             writer.writerow(row)
+
+     print(f"üìä CSV exported to: {Path(output_path).resolve()}")
+
+
+ def export_to_geojson(locations, output_path):
+     """
+     Export locations to GeoJSON format.
+
+     Args:
+         locations (list): List of location dictionaries
+         output_path (str): Path to save the GeoJSON file
+     """
+     os.makedirs(os.path.dirname(output_path), exist_ok=True)
+
+     geojson = {
+         "type": "FeatureCollection",
+         "features": []
+     }
+
+     for loc in locations:
+         feature = {
+             "type": "Feature",
+             "geometry": {
+                 "type": "Point",
+                 "coordinates": [loc['longitude'], loc['latitude']]
+             },
+             "properties": {
+                 "name": loc['name'],
+                 "type": loc.get('type', ''),
+                 "tags": loc.get('tags', []),
+                 "neighborhood": loc.get('neighborhood', ''),
+                 "date_added": loc.get('date_added', ''),
+                 "date_visited": loc.get('date_visited', '')
+             }
+         }
+         geojson["features"].append(feature)
+
+     with open(output_path, 'w', encoding='utf-8') as f:
+         json.dump(geojson, f, indent=2, ensure_ascii=False)
+
+     print(f"üó∫Ô∏è GeoJSON exported to: {Path(output_path).resolve()}")
+
+
+ def export_to_kml(locations, output_path):
+     """
+     Export locations to KML format.
+
+     Args:
+         locations (list): List of location dictionaries
+         output_path (str): Path to save the KML file
+     """
+     os.makedirs(os.path.dirname(output_path), exist_ok=True)
+
+     kml_content = '''<?xml version="1.0" encoding="UTF-8"?>
+ <kml xmlns="http://www.opengis.net/kml/2.2">
+   <Document>
+     <name>Locations</name>
+     <description>Exported locations</description>
+ '''
+
+     for loc in locations:
+         tags_str = ', '.join(loc.get('tags', [])) if loc.get('tags') else ''
+         description = f"Type: {loc.get('type', '')}<br>Tags: {tags_str}<br>Neighborhood: {loc.get('neighborhood', '')}<br>Date Added: {loc.get('date_added', '')}<br>Date Visited: {loc.get('date_visited', '')}"
+
+         kml_content += f'''    <Placemark>
+       <name>{loc['name']}</name>
+       <description><![CDATA[{description}]]></description>
+       <Point>
+         <coordinates>{loc['longitude']},{loc['latitude']},0</coordinates>
+       </Point>
+     </Placemark>
+ '''
+
+     kml_content += '''  </Document>
+ </kml>'''
+
+     with open(output_path, 'w', encoding='utf-8') as f:
+         f.write(kml_content)
+
+     print(f"üó∫Ô∏è KML exported to: {Path(output_path).resolve()}")
+
+
+ def export_to_all_formats(locations, base_path):
+     """
+     Export locations to all supported formats.
+
+     Args:
+         locations (list): List of location dictionaries
+         base_path (str): Base path for output files (without extension)
+     """
+     # Create directory if it doesn't exist
+     os.makedirs(os.path.dirname(base_path), exist_ok=True)
+
+     # Export to different formats
+     export_to_json(locations, f"{base_path}.json")
+     export_to_csv(locations, f"{base_path}.csv")
+     export_to_geojson(locations, f"{base_path}.geojson")
+     export_to_kml(locations, f"{base_path}.kml")
+
+     print(f"‚úÖ All formats exported to: {Path(base_path).parent}")
+

  def show_locations_grouped(locations, group_by="neighborhood", map_filename="map.html"):
```

```diff
      yaml_path = "passages.yaml"  # Replace with your actual YAML file path
      locations = load_locations_from_yaml(yaml_path)
+
+     # Create interactive map
      show_locations_grouped(locations, group_by="neighborhood", map_filename="./maps/passages/map.html")
+
+     # Export to all formats
+     export_to_all_formats(locations, "./maps/passages/passages")

```

---

Now let me test the updated code to make sure it works correctly:


---

Cancelled

---



---
